From 4e315c1c51237439c7d71ddae7f4f7d47126cd24 Mon Sep 17 00:00:00 2001
From: Samrat <samratshekhar42@gmail.com>
Date: Tue, 6 Mar 2018 23:40:37 +0530
Subject: [PATCH] add fb login logic to mainActivity

---
 .../java/com/trovami/activities/MainActivity.java  | 43 +++++++++++++++++-----
 1 file changed, 34 insertions(+), 9 deletions(-)

diff --git a/app/src/main/java/com/trovami/activities/MainActivity.java b/app/src/main/java/com/trovami/activities/MainActivity.java
index 1d8cd42..658fe4d 100644
--- a/app/src/main/java/com/trovami/activities/MainActivity.java
+++ b/app/src/main/java/com/trovami/activities/MainActivity.java
@@ -11,6 +11,11 @@ import android.view.View;
 import android.widget.Button;
 import android.widget.Toast;
 
+import com.facebook.CallbackManager;
+import com.facebook.FacebookCallback;
+import com.facebook.FacebookException;
+import com.facebook.login.LoginResult;
+import com.facebook.login.widget.LoginButton;
 import com.google.android.gms.auth.api.signin.GoogleSignIn;
 import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
 import com.google.android.gms.auth.api.signin.GoogleSignInClient;
@@ -26,27 +31,24 @@ import com.google.firebase.auth.GoogleAuthProvider;
 import com.trovami.R;
 import com.trovami.databinding.ActivityMainBinding;
 
+import java.util.Arrays;
+
 public class MainActivity extends AppCompatActivity implements View.OnClickListener {
 
     private static final String TAG = "MainActivity";
     private static final int RC_GOOGLE_SIGN_IN = 999;
     private ActivityMainBinding mBinding;
     private GoogleSignInClient mGoogleSignInClient;
+    private CallbackManager mFacebookCallbackManagaer;
     private FirebaseAuth mAuth;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
+        this.setupUI();
         this.setupFirebaseAuth();
-        if(this.isLoggedId()) {
-            //TODO: show home
-            this.setupUI();
-            this.setupGoogleClient();
-
-        } else {
-            this.setupUI();
-            this.setupGoogleClient();
-        }
+        this.setupGoogleClient();
+        this.setupFacebookClient();
     }
 
     private void setupUI() {
@@ -69,6 +71,28 @@ public class MainActivity extends AppCompatActivity implements View.OnClickListe
         mGoogleSignInClient = GoogleSignIn.getClient(this, gso);
     }
 
+    private void setupFacebookClient() {
+        mFacebookCallbackManagaer = CallbackManager.Factory.create();
+        mBinding.loginButton.setReadPermissions(Arrays.asList("email"));
+        mBinding.loginButton.registerCallback(mFacebookCallbackManagaer, new FacebookCallback<LoginResult>() {
+            @Override
+            public void onSuccess(LoginResult loginResult) {
+                Log.d(TAG, "facebook:onSuccess:" + loginResult);
+                Log.d(TAG, "facebook:onSuccess:" + loginResult.getAccessToken());
+            }
+
+            @Override
+            public void onCancel() {
+                Log.d(TAG, "facebook:onCancel");
+            }
+
+            @Override
+            public void onError(FacebookException exception) {
+                Log.d(TAG, "facebook:onError", exception);
+            }
+        });
+    }
+
     private boolean isLoggedId() {
         FirebaseUser currentUser = mAuth.getCurrentUser();
         if (currentUser != null) return true;
@@ -99,6 +123,7 @@ public class MainActivity extends AppCompatActivity implements View.OnClickListe
     @Override
     public void onActivityResult(int requestCode, int resultCode, Intent data) {
         super.onActivityResult(requestCode, resultCode, data);
+        mFacebookCallbackManagaer.onActivityResult(requestCode, resultCode, data);
         if (requestCode == RC_GOOGLE_SIGN_IN) {
             Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);
             try {
-- 
2.15.1

