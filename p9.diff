From 9303c4a24eab0db6c46f82d4ea34cf13b5f2bdbb Mon Sep 17 00:00:00 2001
From: Samrat <samratshekhar42@gmail.com>
Date: Wed, 7 Mar 2018 10:40:03 +0530
Subject: [PATCH] implement firebase facebook auth

---
 .../java/com/trovami/activities/MainActivity.java  | 30 ++++++++++++++++++++++
 1 file changed, 30 insertions(+)

diff --git a/app/src/main/java/com/trovami/activities/MainActivity.java b/app/src/main/java/com/trovami/activities/MainActivity.java
index 658fe4d..2e626ff 100644
--- a/app/src/main/java/com/trovami/activities/MainActivity.java
+++ b/app/src/main/java/com/trovami/activities/MainActivity.java
@@ -11,6 +11,7 @@ import android.view.View;
 import android.widget.Button;
 import android.widget.Toast;
 
+import com.facebook.AccessToken;
 import com.facebook.CallbackManager;
 import com.facebook.FacebookCallback;
 import com.facebook.FacebookException;
@@ -25,6 +26,7 @@ import com.google.android.gms.tasks.OnCompleteListener;
 import com.google.android.gms.tasks.Task;
 import com.google.firebase.auth.AuthCredential;
 import com.google.firebase.auth.AuthResult;
+import com.google.firebase.auth.FacebookAuthProvider;
 import com.google.firebase.auth.FirebaseAuth;
 import com.google.firebase.auth.FirebaseUser;
 import com.google.firebase.auth.GoogleAuthProvider;
@@ -79,6 +81,7 @@ public class MainActivity extends AppCompatActivity implements View.OnClickListe
             public void onSuccess(LoginResult loginResult) {
                 Log.d(TAG, "facebook:onSuccess:" + loginResult);
                 Log.d(TAG, "facebook:onSuccess:" + loginResult.getAccessToken());
+                firebaseAuthWithFacebook(loginResult.getAccessToken());
             }
 
             @Override
@@ -159,4 +162,31 @@ public class MainActivity extends AppCompatActivity implements View.OnClickListe
                     }
                 });
     }
+
+    private void firebaseAuthWithFacebook(AccessToken token) {
+        Log.d(TAG, "handleFacebookAccessToken:" + token);
+
+        AuthCredential credential = FacebookAuthProvider.getCredential(token.getToken());
+        mAuth.signInWithCredential(credential)
+                .addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {
+                    @Override
+                    public void onComplete(@NonNull Task<AuthResult> task) {
+                        if (task.isSuccessful()) {
+                            // Sign in success, update UI with the signed-in user's information
+                            Log.d(TAG, "signInWithCredential:success");
+                            FirebaseUser user = mAuth.getCurrentUser();
+                            Log.d(TAG, user.getDisplayName());
+                            // updateUI(user);
+                        } else {
+                            // If sign in fails, display a message to the user.
+                            Log.w(TAG, "signInWithCredential:failure", task.getException());
+                            AuthResult result = task.getResult();
+                            Log.w(TAG, "signInWithCredential:failure" + result);
+                            // updateUI(null);
+                        }
+
+                        // ...
+                    }
+                });
+    }
 }
-- 
2.15.1

